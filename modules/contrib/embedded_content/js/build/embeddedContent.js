!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.embeddedContent=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/widget.js":(e,t,n)=>{e.exports=n("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function n(i){var d=t[i];if(void 0!==d)return d.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";n.d(i,{default:()=>m});var e=n("ckeditor5/src/core.js"),t=n("ckeditor5/src/widget.js");const d=(e,t,n)=>{Drupal.ajax({dialog:{width:e.dialogSettings.width,height:e.dialogSettings.height,class:e.class},dialogType:"off_canvas"===e.dialogSettings.renderer?"dialog":"modal",dialogRenderer:"off_canvas"===e.dialogSettings.renderer?"off_canvas":null,selector:e.dialogSettings.selector,url:e.dialogUrl,progress:{type:"fullscreen"},submit:n}).execute(),Drupal.ckeditor5.saveCallback instanceof Map?Drupal.ckeditor5.saveCallback.set("#embedded-content-dialog-form-"+e.editor_id,t):Drupal.ckeditor5.saveCallback=t},o=e=>{const t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t.responseText};class r extends e.Command{execute(e,t){const{model:n}=this.editor,i=this.editor.plugins.get("embeddedContentEditing"),d=Object.fromEntries(Object.entries(i.attrs).map((([e,t])=>[t,e]))),o=Object.fromEntries(Object.keys(d).filter((t=>e[t])).map((t=>[d[t],e[t]])));n.change((e=>{n.insertContent(((e,t,n)=>e.createElement(n,t))(e,o,t))}))}}class s extends e.Plugin{static get requires(){return[t.Widget]}init(){this.attrs={dataPluginConfig:"data-plugin-config",dataPluginId:"data-plugin-id",dataButtonId:"data-button-id"};const e=this.editor.config.get("embeddedContent");if(!e)throw new Error("Error on initializing embeddedContent plugin: embeddedContent config is required.");this.options=e,this.labelError=Drupal.t("Preview failed"),this.previewError=`\n      <p>${Drupal.t("An error occurred while trying to preview the embedded content. Please save your work and reload this page.")}<p>\n    `,this._defineSchema(),this._defineConverters(),this.editor.commands.add("insertEmbeddedContent",new r(this.editor))}_defineSchema(){const{schema:e}=this.editor.model;e.register("embeddedContent",{isObject:!0,isContent:!0,isBlock:!0,allowWhere:"$block",allowAttributes:Object.keys(this.attrs)}),e.register("embeddedContentInline",{isObject:!0,isContent:!0,isBlock:!0,isInline:!0,allowWhere:"$text",allowAttributes:Object.keys(this.attrs)}),this.editor.editing.view.domConverter.blockElements.push("embedded-content"),this.editor.editing.view.domConverter.blockElements.push("embedded-content-inline")}_defineConverters(){const{conversion:e}=this.editor;Object.entries({"embedded-content":"embeddedContent","embedded-content-inline":"embeddedContentInline"}).forEach((([n,i])=>{e.for("upcast").elementToElement({view:{name:n},model:i}),e.for("dataDowncast").elementToElement({model:i,view:{name:n}}),e.for("dataDowncast").elementToElement({model:i,view:{name:n}}),e.for("editingDowncast").elementToElement({model:i,view:(e,{writer:i})=>{const d=i.createContainerElement("figure",{class:`embedded-content-preview-wrapper ${n}`});return i.setCustomProperty("embeddedContent",!0,d),(0,t.toWidget)(d,i,{label:Drupal.t("Embedded content")})}}).add((e=>(e.on(`attribute:dataPluginId:${i}`,((e,t,i)=>{const d=i.writer,o=t.item,r=i.mapper.toViewElement(t.item),s=d.createRawElement("span",{"data-embedded-content-preview":"loading",class:`embedded-content-preview ${n}`});d.insert(d.createPositionAt(r,0),s),this._fetchPreview(o).then((e=>{s&&this.editor.editing.view.change((t=>{const i=t.createRawElement("span",{class:`embedded-content-preview ${n}`,"data-embedded-content-preview":"ready"},(t=>{t.innerHTML=e}));t.insert(t.createPositionBefore(s),i),t.remove(s)}))}))})),e))),Object.keys(this.attrs).forEach((t=>{const d={model:{key:t,name:i},view:{name:n,key:this.attrs[t]}};e.for("dataDowncast").attributeToAttribute(d),e.for("upcast").attributeToAttribute(d)}))}))}async _fetchPreview(e){const t={plugin_id:e.getAttribute("dataPluginId"),plugin_config:e.getAttribute("dataPluginConfig"),editor_id:this.editor.id},n=await fetch(this.options.previewUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return n.ok?n.text():this.themeError}static get pluginName(){return"embeddedContentEditing"}}var a=n("ckeditor5/src/ui.js");class l extends e.Plugin{static get requires(){return[t.WidgetToolbarRepository]}init(){const{editor:t}=this,n=t.config.get("embeddedContent");t.ui.componentFactory.add("embeddedContentEdit",(i=>{const o=new a.ButtonView(i);return o.set({label:t.t("Edit"),icon:e.icons.pencil,tooltip:!0,class:"ck-button_embedded-content__edit"}),this.listenTo(o,"execute",(()=>{const e=t.model.document.selection.getSelectedElement(),i=e.getAttribute("dataButtonId")??"default",o=n.buttons[i];o.editor_id=t.id;const r={plugin_id:e.getAttribute("dataPluginId"),plugin_config:e.getAttribute("dataPluginConfig"),editor_id:t.id};d(o,(({attributes:e,element:n})=>{t.execute("insertEmbeddedContent",e,n),t.editing.view.focus()}),r)})),o}))}afterInit(){const{editor:e}=this;if(!e.plugins.has("WidgetToolbarRepository"))return;e.plugins.get(t.WidgetToolbarRepository).register("embeddedContent",{ariaLabel:Drupal.t("EmbeddedContent toolbar"),items:["embeddedContentEdit"],getRelatedElement(e){const n=e.getSelectedElement();return n&&(0,t.isWidget)(n)&&n.getCustomProperty("embeddedContent")?n:null}})}static get pluginName(){return"EmbeddedContentToolbar"}}class c extends e.Plugin{static get requires(){return["Widget"]}init(){const{editor:e}=this,t=e.commands.get("insertEmbeddedContent"),n=e.config.get("embeddedContent");if(!n)return;const{buttons:i}=n;Object.keys(i).forEach((n=>{e.ui.componentFactory.add(`embeddedContent__${n}`,(r=>{const s=i[n],l=new a.ButtonView(r);l.set({label:s.label,icon:o(s.iconUrl),tooltip:!0,class:`ck-button_embedded-content ck-button_embedded-content__${n}`});const c=s.dialogSettings||{};s.editor_id=e.id,c.editor_id=e.id;return l.bind("isOn","isEnabled").to(t,"value","isEnabled"),this.listenTo(l,"execute",(()=>{d(s,(({attributes:t,element:n})=>{e.execute("insertEmbeddedContent",t,n)}),c)})),l}))}))}static get pluginName(){return"EmbeddedContentUI"}}class u extends e.Plugin{static get requires(){return[s,c,l]}static get pluginName(){return"EmbeddedContent"}}const m={EmbeddedContent:u}})(),i=i.default})()));